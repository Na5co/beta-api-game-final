(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{15028:function(e,t,i){"use strict";i.r(t),function(e){i.d(t,"default",(function(){return v}));var s,o,a=i(1251),r=i(15012),n=i(5107),c=i(5101),d=i(5110),l=i(5113),u=i(15029),b=i(3865),h=i(3870),p=i(5469),m=i(3727),w=i(4237),y=i(4305),g=i(4211);function S(e,t,i,s,o){var a={};return Object.keys(s).forEach((function(e){a[e]=s[e]})),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=i.slice().reverse().reduce((function(i,s){return s(e,t,i)||i}),a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}let v=(o=S((s=class{constructor(){var e,t,i,s;this.model=null,this._adapters=[],e=this,t="status",s=this,(i=o)&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(s):void 0})}async didCreate(){if(this.model=new r.f,"browser"!==window.SDK_PLATFORM){if(!pm.isScratchpad){const t=await this._fetchCollections();this.setSidebarStatus(p.d),function(t){if(e.isEmpty(t))return;const i=[],s=[],o=[],a=[];t.forEach(t=>{const r=e.get(t,"attributes.flags.isFavorite"),n=e.get(t,"attributes.permissions.teamCanView"),c=e.get(t,"attributes.permissions.anybodyCanView"),d=e.get(t,"attributes.flags.isArchived"),l=Object(w.z)(t.id).modelId,u={id:l};r&&i.push(u),n&&s.push(u),c&&o.push({id:t.id}),d&&a.push({model:"collection",modelId:l})}),!e.isEmpty(i)&&Object(m.getStore)("FavoritedCollectionStore").add(i),!e.isEmpty(s)&&Object(m.getStore)("SharedCollectionsStore").add(s),!e.isEmpty(o)&&Object(m.getStore)("PublicEntityStore").add(o),!e.isEmpty(a)&&Object(m.getStore)("ArchivedResourceStore").add(a)}(t)}const t=await b.a.getActiveSession(),i=t&&t.workspace?t.workspace:await Object(h.c)(),s=new n.a(this.model.getCollectionAdapterModel(),{activeWorkspace:i,useUID:!0}),o=new c.a(this.model.getFolderAdapterModel()),a=new d.a(this.model.getRequestAdapterModel()),r=[s.hydrate(),o.hydrate(),a.hydrate()];return this._adapters.push(s,o,a),Promise.all(r).then(()=>{const e=new l.a(this.model.getResponseAdapterModel());return this._adapters.push(e),this.setSidebarStatus(p.d),e.hydrate()})}const t=new u.a(this.model.getCollectionAdapterModel());this._adapters.push(t),t.hydrate().then(()=>{this.setSidebarStatus(p.d),window.analytics.sentFirstLoadMetrics||(window.analytics.sentFirstLoadMetrics=!0,window.analytics.sendAnalytics("workspace_page","workspace_page_sidebar_collection_listing_load_time"),window.analytics.workspaces.sidebar=!0,window.analytics.workspaces.overview&&window.analytics.workspaces.activities&&window.analytics.workspaces.sidebar&&(window.analytics.sendAnalytics("workspace_page","workspace_page_load_time"),window.analytics.metricsCaptureComplete=!0))}).catch(e=>{this.setSidebarStatus(p.b),pm.logger.error("CollectionSidebarController~fetchCollections: Error in loading collection list",e)})}beforeDestroy(){this._adapters&&this._adapters.forEach(t=>{e.isFunction(t.dispose)&&t.dispose()}),this.model=null,this._adapters=[]}setSidebarStatus(e){this.status=e}_fetchCollections(){return Object(m.getStore)("SyncStatusStore").onSyncAvailable().then(()=>{const e=Object(m.getStore)("ActiveWorkspaceStore").id;return w.p.request(y.e`${e}`,{method:"POST",timeout:3e4})}).then(t=>{const i=e.forEach(e.get(t,"body.data",[]),t=>{const i={model:"collection",modelId:t.id,action:"UPDATE_COLLECTION"},s=g.a.getCompositeKey(i);!Object(m.getStore)("PermissionStore").members.has(s)&&e.set(t,"attributes.permissions.userCanUpdate",!0)});return this.model.hydrate&&this.model.hydrate(i),i})}}).prototype,"status",[a.observable],{enumerable:!0,initializer:function(){return p.c}}),S(s.prototype,"setSidebarStatus",[a.action],Object.getOwnPropertyDescriptor(s.prototype,"setSidebarStatus"),s.prototype),s)}.call(this,i(1026))},15029:function(e,t,i){"use strict";(function(e){i.d(t,"a",(function(){return u}));var s=i(5103),o=i(3924),a=i(2297),r=i(15030),n=i(3727),c=i(4305),d=i(3741),l=i(3746);let u=class extends s.a{hydrate(){return new Promise((t,i)=>{this._connection_subscription=Object(o.a)().subscribe(s=>{if("connect"===s)return this._fetchCollections().then(t=>{const i=e.get(t,"body.subscription.id");i&&this._subscribeToChangeEvents(i)}).then(()=>t()).catch(e=>(pm.logger.warn("ListingAPIAdapter~hydrate: Failed to hydrate collections",e),i(e)))})})}dispose(){super.dispose(),this._connection_subscription&&this._connection_subscription.unsubscribe(),this._realtime_subscription&&this._realtime_subscription.unsubscribe(),this.unsubscribeModelEvents&&this.unsubscribeModelEvents()}_fetchCollections(){return Object(n.getStore)("SyncStatusStore").onSyncAvailable().then(()=>{const e=Object(n.getStore)("ActiveWorkspaceStore").id;return a.a.request(c.e`${e}`,{method:"POST",timeout:3e4})}).then(t=>(this.model.hydrate&&this.model.hydrate(e.get(t,"body.data",[])),t))}_subscribeToChangeEvents(t){this._realtime_subscription&&this._realtime_subscription.unsubscribe(),this._realtime_subscription=Object(r.a)(t).subscribe(t=>{const i=e.get(t,"data.data",[]),s=i.filter(({action:e})=>["create","update"].includes(e)).map(({id:e})=>e),o=i.filter(({action:e})=>"delete"===e).map(({id:e})=>e);this.model.remove&&this.model.remove(o),this._createOrUpdateCollection(s)}),this.unsubscribeModelEvents&&this.unsubscribeModelEvents(),this.unsubscribeModelEvents=pm.eventBus.channel("model-events").subscribe(t=>{if("collection"!==Object(d.getEventNamespace)(t))return;const i=Object(d.getEventName)(t);if(!["favorite","unfavorite"].includes(i))return;const s=Object(d.getEventData)(t),o=e.get(s,"collection.id"),a=e.get(s,"collection.owner"),r=Object(l.a)(o,a),n="favorite"===i;this.model.updateFavorite&&this.model.updateFavorite(r,n)})}async _createOrUpdateCollection(t){if(e.isEmpty(t))return;await Object(n.getStore)("SyncStatusStore").onSyncAvailable();const i=Object(n.getStore)("ActiveWorkspaceStore").id,s=await a.a.request(c.d`${i}`,{method:"POST",data:{ids:t},timeout:3e4}),o=e.get(s,"body.data",[]);e.isEmpty(o)||this.model.add&&this.model.add(o)}}}).call(this,i(1026))},15030:function(e,t,i){"use strict";(function(e){i.d(t,"a",(function(){return a}));var s=i(4010),o=i(4112);function a(t){return Object(o.a)().pipe(Object(s.e)(i=>e.get(i,"data.subscription.id")===t))}}).call(this,i(1026))}}]);
//# sourceMappingURL=CollectionSidebarController-14e4539dda230ce2bccc.min.js.map